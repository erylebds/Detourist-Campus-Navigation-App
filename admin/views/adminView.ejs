<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Detourist Admin</title>
    <link rel="stylesheet" href="/css/admin-style.css">
</head>

<body>

    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <img src="/assets/icons/logoD.png" alt="Detourist logo">
                <h2>Detourist</h2>
                <p>Admin Navigation</p>
            </div>

            <nav class="admin-nav">
                <form method="get" id="tabForm">
                </form>
                <button type="button"
                    class="<%= activeTab === 'announcements' ? 'active' : '' %>"
                    onclick="window.location.href='/admin?tab=announcements'">
                    <span class="icon">üîî</span> Announcements
                </button>
                <button type="button"
                    class="<%= activeTab === 'rooms' ? 'active' : '' %>"
                    onclick="window.location.href='/admin?tab=rooms'">
                    <span class="icon">üè´</span> Rooms
                </button>
                <button type="button"
                    class="<%= activeTab === 'routes' ? 'active' : '' %>"
                    onclick="window.location.href='/admin?tab=routes'">
                    <span class="icon">üß≠</span> Routes
                </button>
                <button type="button"
                    class="<%= activeTab === 'account' ? 'active' : '' %>"
                    onclick="window.location.href='/admin?tab=account'">
                    <span class="icon">üë§</span> Account
                </button>
            </nav>
        </aside>

        <main class="admin-main">
            <div class="admin-topbar">
                <p>Logged in as: <strong>&nbsp;<%= adminUsername %></strong></p>
                <a class="logout-link" href="/admin/logout">Log Out</a>
            </div>

            <!-- Announcements Tab -->
            <section class="admin-tab <%= activeTab === 'announcements' ? 'active' : '' %>" id="tab-announcements">
                <h1 class="section-title">Announcements</h1>

                <% if (annMsg) { %>
                    <div class="msg-success"><%= annMsg %></div>
                <% } %>

                <div class="card-box">
                    <h2><%= editAnnouncement ? 'Edit Announcement' : 'Add New Announcement' %></h2>
                    <form method="POST" action="/admin/announcements">
                        <input type="hidden" name="form_type" value="announcement">
                        <% if (editAnnouncement) { %>
                            <input type="hidden" name="announcement_id" value="<%= editAnnouncement.announcement_id %>">
                        <% } %>

                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title" required
                            value="<%= editAnnouncement ? editAnnouncement.title : '' %>">

                        <label for="message">Message:</label>
                        <textarea id="message" name="message" required><%= editAnnouncement ? editAnnouncement.message : '' %></textarea>

                        <label for="created_at">Date &amp; Time:</label>
                        <input type="datetime-local" id="created_at" name="created_at"
                            value="<%= editAnnouncement ? editAnnouncement.created_at : new Date().toISOString().slice(0,16) %>">

                        <button type="submit" class="btn-primary">Save Announcement</button>
                        <% if (editAnnouncement) { %>
                            <a href="/admin?tab=announcements" class="btn-secondary">Cancel</a>
                        <% } %>
                    </form>
                </div>

                <div class="card-box">
                    <h2>Existing Announcements</h2>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Message</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% announcements.forEach(a => { %>
                                <tr>
                                    <td><%= a.announcement_id %></td>
                                    <td><%= a.title %></td>
                                    <td><%= a.message %></td>
                                    <td><%= a.created_at %></td>
                                    <td>
                                        <a href="/admin/announcements/edit/<%= a.announcement_id %>">Edit</a> |
                                        <a href="/admin/announcements/delete/<%= a.announcement_id %>"
                                            onclick="return confirm('Delete this announcement?');"
                                            style="color:#e74c3c;">Delete</a>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Rooms Tab -->
            <section class="admin-tab <%= activeTab === 'rooms' ? 'active' : '' %>" id="tab-rooms">
                <h1 class="section-title">Rooms</h1>
                <div class="card-box">
                    <p>Rooms management (to follow)</p>
                </div>
            </section>

            <!-- Routes Tab -->
            <section class="admin-tab <%= activeTab === 'routes' ? 'active' : '' %>" id="tab-routes">
                <h1 class="section-title">Routes</h1>
                <div class="card-box">
                    <p>Routes management (to follow)</p>
                </div>
            </section>

            <!-- Account Tab -->
            <section class="admin-tab <%= activeTab === 'account' ? 'active' : '' %>" id="tab-account">
                <h1 class="section-title">Account</h1>

                <% if (accError) { %>
                    <div class="msg-error"><%= accError %></div>
                <% } %>
                <% if (accMsg) { %>
                    <div class="msg-success"><%= accMsg %></div>
                <% } %>

                <div class="card-box account-info">
                    <h2>Account Information</h2>
                    <p><strong>Username:</strong> <%= currentAdmin.username %></p>
                    <p><strong>Email:</strong> <%= currentAdmin.email %></p>
                </div>

                <div class="card-box">
                    <h2>Change Password</h2>
                    <form method="POST" action="/admin/account/password">
                        <input type="hidden" name="form_type" value="password">

                        <label for="old_password">Enter Old Password:</label>
                        <input type="password" id="old_password" name="old_password" required>

                        <label for="new_password">Enter New Password:</label>
                        <input type="password" id="new_password" name="new_password" required>

                        <label for="new_password2">Enter Again New Password:</label>
                        <input type="password" id="new_password2" name="new_password2" required>

                        <button type="submit" class="btn-primary">Save</button>
                    </form>
                </div>

                <div class="card-box">
                    <h2>Change Username</h2>
                    <form method="POST" action="/admin/account/username">
                        <input type="hidden" name="form_type" value="username">

                        <label for="old_username">Enter Old Username:</label>
                        <input type="text" id="old_username" name="old_username" required>

                        <label for="new_username">Enter New Username:</label>
                        <input type="text" id="new_username" name="new_username" required>

                        <label for="cu_password">Enter Password:</label>
                        <input type="password" id="cu_password" name="cu_password" required>

                        <button type="submit" class="btn-primary">Save</button>
                    </form>
                </div>
            </section>

        </main>
    </div>

</body>

</html>
